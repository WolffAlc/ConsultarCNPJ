unit consultarcnpj.view.principal;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, System.JSON, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, IPPeerClient, Vcl.StdCtrls, REST.Client, REST.Types,
  Data.Bind.Components, Data.Bind.ObjectScope, Vcl.ComCtrls, Vcl.ExtCtrls;

type
  TviewPrincipal = class(TForm)
    RESTClient1: TRESTClient;
    RESTRequest1: TRESTRequest;
    RESTResponse1: TRESTResponse;
    pnlConsulta: TPanel;
    edtCnpj: TEdit;
    btConsultarCnpj: TButton;
    pnlDadosEmpresa: TPanel;
    Label17: TLabel;
    Label18: TLabel;
    Label19: TLabel;
    Label20: TLabel;
    Label21: TLabel;
    Label22: TLabel;
    Edit1: TEdit;
    Edit2: TEdit;
    Label23: TLabel;
    GroupBox3: TGroupBox;
    Label24: TLabel;
    Label25: TLabel;
    Label26: TLabel;
    Edit3: TEdit;
    Edit4: TEdit;
    Edit5: TEdit;
    GroupBox4: TGroupBox;
    Label27: TLabel;
    Label28: TLabel;
    Label29: TLabel;
    Label30: TLabel;
    Label31: TLabel;
    Label32: TLabel;
    Label33: TLabel;
    Label34: TLabel;
    Edit6: TEdit;
    Edit7: TEdit;
    Edit8: TEdit;
    Edit9: TEdit;
    Edit10: TEdit;
    Edit11: TEdit;
    Edit12: TEdit;
    Edit13: TEdit;
    procedure btConsultarCnpjClick(Sender: TObject);
    procedure FormShow(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

  const
    _URL_CONSULTA_CNPJ = 'https://receitaws.com.br/v1/cnpj/%s';


var
  viewPrincipal: TviewPrincipal;

implementation

{$R *.dfm}

procedure TviewPrincipal.btConsultarCnpjClick(Sender: TObject);
var
  LCNPJ, LrespostaConsultaCNPJ: string;
  LJSONObj: TJSONobject;
  LJSONArr : TJSONArray;
  LJSONValue : TJSONValue;
begin
  LCNPJ := trim(edtCnpj.text);
    restclient1.baseURL := format(_URL_CONSULTA_CNPJ, [LCNPJ]);

  restrequest1.Method := rmGET;
  restrequest1.Execute;

  LrespostaConsultaCNPJ := RESTResponse1.Content;
  LJSONObj:= RestRequest1.Response.JSONValue as TJSONObject;

  cSituacao.Caption :=
  LJSONObj.Values['situacao'].Value;
  cStatus.Caption :=
  LJSONObj.Values['status'].Value;
  edtData.text :=
  LJSONObj.Values['abertura'].Value;
  edtNome.Text :=
  LJSONObj.Values['nome'].Value;
  edtNomeFantasia.Text :=
  LJSONObj.Values['fantasia'].Value;
  edtPorte.Text :=
  LJSONObj.Values['porte'].Value;
  edtNatJuridica.Text :=
  LJSONObj.Values['natureza_juridica'].Value;
  edtRua.Text :=
  LJSONObj.Values['logradouro'].Value;
  edtNumRua.Text :=
  LJSONObj.Values['numero'].Value;
  edtCidade.Text :=
  LJSONObj.Values['municipio'].Value;
  edtBairro.Text :=
  LJSONObj.Values['bairro'].Value;
  edtCep.Text :=
  LJSONObj.Values['cep'].Value;
  edtUf.Text :=
  LJSONObj.Values['uf'].Value;
  edtTelefone.Text :=
  LJSONObj.Values['telefone'].Value;
  edtEmail.Text :=
  LJSONObj.Values['email'].Value;


   PageControl1.ActivePageIndex := tabDadosEmpresa.TabIndex;


end;

end.
